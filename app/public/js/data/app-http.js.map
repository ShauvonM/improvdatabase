{"version":3,"sources":["../../src/ts/data/app-http.ts"],"names":[],"mappings":"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","file":"app-http.js","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { \r\n    Headers,\r\n    Http,\r\n    Request,\r\n    ConnectionBackend,\r\n    RequestOptions,\r\n    RequestOptionsArgs,\r\n    Response\r\n} from '@angular/http';\r\nimport { Router } from '@angular/router';\r\nimport { Observable } from 'rxjs/Observable';\r\n\r\nimport { LocalStorage } from \"../util/webstorage.util\";\r\n\r\nimport { UserService } from '../service/user.service';\r\n\r\n@Injectable()\r\nexport class AppHttp {\r\n\r\n    @LocalStorage()\r\n    private token: string;\r\n\r\n    @LocalStorage()\r\n    private tokenExpires: number;\r\n\r\n    constructor(\r\n        private http: Http,\r\n        private router: Router\r\n    ) {}\r\n\r\n    checkTokenExpiration(): boolean {\r\n        if (!this.token || !this.tokenExpires || this.tokenExpires <= Date.now()) {\r\n            this.token = '';\r\n            this.tokenExpires = null;\r\n            return false;\r\n        } else {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    setToken(token: string, expires: number): void {\r\n        this.token = token;\r\n        this.tokenExpires = expires;\r\n    }\r\n\r\n    getToken(): string {\r\n        return this.token;\r\n    }\r\n\r\n    request(url: string | Request, options?: RequestOptionsArgs): Observable<Response> {\r\n        return this.intercept(this.http.request(url, this.getRequestOptionArgs(options)));\r\n    }\r\n\r\n    get(url: string, options?: RequestOptionsArgs): Observable<Response> {\r\n        return this.intercept(this.http.get(url, this.getRequestOptionArgs(options)));\r\n    }\r\n\r\n    post(url: string, body: any, options?: RequestOptionsArgs): Observable<Response> {\r\n        return this.intercept(this.http.post(url, body, this.getRequestOptionArgs(options)));\r\n    }\r\n\r\n    put(url: string, body: any, options?: RequestOptionsArgs): Observable<Response> {\r\n        return this.intercept(this.http.put(url, body, this.getRequestOptionArgs(options)));\r\n    }\r\n\r\n    delete(url: string, options?: RequestOptionsArgs): Observable<Response> {\r\n        return this.intercept(this.http.delete(url, this.getRequestOptionArgs(options)));\r\n    }\r\n    \r\n    appendAuthorizationHeader(headers: Headers): Headers {\r\n        // TODO: somehow make this asynchronous so we can refresh the token if necessary?\r\n        if (this.checkTokenExpiration()) {\r\n            headers.append('x-access-token', this.token);\r\n        }\r\n        headers.append('Content-Type', 'application/json');\r\n        return headers;\r\n    }\r\n\r\n    getRequestOptionArgs(options?: RequestOptionsArgs): RequestOptionsArgs {\r\n        if (options == null) {\r\n            options = new RequestOptions();\r\n        }\r\n        if (options.headers == null) {\r\n            options.headers = new Headers();\r\n        }\r\n        this.appendAuthorizationHeader(options.headers);\r\n        return options;\r\n    }\r\n\r\n    intercept(observable: Observable<Response>): Observable<Response> {\r\n        return observable.catch((err, source) => {\r\n            if (err.status == 401 && err.url.indexOf('/login') == -1) {\r\n                this.router.navigate(['/app/unauthorized']);\r\n                return Observable.empty();\r\n            } else {\r\n                return Observable.throw(err);\r\n            }\r\n        });\r\n    }\r\n\r\n}"]}