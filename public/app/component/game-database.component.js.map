{"version":3,"sources":["../src/ts/app/component/game-database.component.ts"],"names":[],"mappings":"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","file":"game-database.component.js","sourcesContent":["import {\r\n    Component,\r\n    OnInit,\r\n    OnDestroy,\r\n    trigger,\r\n    state,\r\n    style,\r\n    transition,\r\n    animate\r\n} from '@angular/core';\r\nimport { PathLocationStrategy } from '@angular/common';\r\n\r\nimport { Router, ActivatedRoute, Params } from '@angular/router';\r\nimport 'rxjs/Subscription';\r\nimport { Subscription } from 'rxjs/Subscription';\r\n\r\nimport { AppComponent } from './app.component';\r\nimport { Tool, SearchResult, ToolbarComponent } from './toolbar.component';\r\nimport { GameDatabaseService } from '../service/game-database.service';\r\n\r\nimport { Game } from '../model/game';\r\nimport { Name } from '../model/name';\r\n\r\nimport { GameFilter } from '../pipe/game-filter.pipe';\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    selector: \"game-database\",\r\n    templateUrl: '../template/game-database.component.html',\r\n    animations: [\r\n        trigger('flyInOut', [\r\n            state('in',   style({\r\n                opacity: 1\r\n            })),\r\n            transition('void => *', [\r\n                style({opacity: 0}),\r\n                animate(100)\r\n            ]),\r\n            transition('* => void', [\r\n                animate(100, style({opacity: 0}))\r\n            ])\r\n        ])\r\n    ]\r\n})\r\nexport class GameDatabaseComponent implements OnInit, OnDestroy {\r\n    games: Game[] = [];\r\n    names: Name[] = [];\r\n    selectedGame: Game;\r\n\r\n    scrollpos: number = 0;\r\n\r\n    private _titleBase: string = \"Games \";\r\n    title: string;\r\n\r\n    searchResults: SearchResult[] = [];\r\n    filter: GameFilter;\r\n\r\n    constructor(\r\n        private _app: AppComponent,\r\n        private route: ActivatedRoute,\r\n        private router: Router,\r\n        private gameDatabaseService: GameDatabaseService,\r\n        private pathLocationStrategy: PathLocationStrategy\r\n    ) { }\r\n\r\n    private tools: Tool[] = [\r\n        {\r\n            icon: \"fa-hashtag\",\r\n            name: \"showTags\",\r\n            text: \"Show Tags\",\r\n            active: false\r\n        },\r\n        {\r\n            icon: \"fa-random\",\r\n            name: \"randomGame\",\r\n            text: \"Select Random Game\",\r\n            active: false\r\n        }\r\n    ];\r\n\r\n    ngOnInit(): void {\r\n        this.setTitle();\r\n\r\n        //this.toolSubscription = this.toolService.tool$.subscribe(this.onToolClicked);\r\n\r\n        this._app.showLoader();\r\n        this.getGames();\r\n\r\n        this.pathLocationStrategy.onPopState(() => {\r\n            this.selectedGame = null;\r\n        });\r\n    }\r\n\r\n    setTitle(): void {\r\n        this.title = this._titleBase;\r\n\r\n        if (this.filter && this.filter.property == 'search') {\r\n            this.title = \"Search Results\";\r\n        } else if (this.filter) {\r\n            this.title += '<span>Filtered</span>';\r\n        }\r\n    }\r\n\r\n    getGames(): void {\r\n        this.gameDatabaseService.getGames('name').then(games => {\r\n            games = this._filterGames(games);\r\n            this._loadGames(games);\r\n        });\r\n    }\r\n\r\n    getGamesSearch(term: string): void {\r\n        this.gameDatabaseService.searchForGames(term).then(games => this._loadGames(games))\r\n    }\r\n\r\n    private _loadGames(games: Game[]): void {\r\n        setTimeout(() => {\r\n            this._app.hideLoader();\r\n            this.games = games;\r\n            this.onGamesLoaded();\r\n        }, 1);\r\n    }\r\n\r\n    private _filterGames(games: Game[]): Game[] {\r\n        if (this.filter) {\r\n            return games.filter((game) => {\r\n                if (this.filter.property == 'TagID') {\r\n                    for (var tagIDIndex = 0; tagIDIndex < game.TagGames.length; tagIDIndex++) {\r\n                        if (game.TagGames[tagIDIndex].TagID == this.filter.value) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                    return false;\r\n                } else {\r\n                    return game[this.filter.property] == this.filter.value;\r\n                }\r\n            });\r\n        } else {\r\n            return games;\r\n        }\r\n    }\r\n\r\n    onGamesLoaded(): void {\r\n        // navigate to games;random=random to load a random game\r\n        this.route.params.forEach((params: Params) => {\r\n            if (params['random']) {\r\n                this.pathLocationStrategy.replaceState({}, \"\", \"/games\", \"\");\r\n                this.selectRandomGame();\r\n            }\r\n        })\r\n    }\r\n\r\n    trackByGames(index: number, game: Game) {\r\n        return game.GameID;\r\n    }\r\n\r\n    onScroll($event): void {\r\n        this.scrollpos = $event.target.scrollTop;\r\n    }\r\n\r\n    onSelect(game: Game): void {\r\n        if (!game) {\r\n            this.selectedGame = null;\r\n        } else {\r\n            this.selectedGame = game;\r\n        }\r\n    \r\n        let newPath = \"/game/\" + this.selectedGame.GameID;\r\n        if (this.pathLocationStrategy.path().indexOf(\"/game/\") > -1) {\r\n            this.pathLocationStrategy.replaceState({}, \"\", newPath, \"\");\r\n        } else {\r\n            this.pathLocationStrategy.pushState({}, \"\", newPath, \"\");\r\n        }\r\n    }\r\n\r\n    selectRandomGame(): void {\r\n        let i = Math.floor((Math.random() * this.games.length));\r\n        this.onSelect(this.games[i]);\r\n    }\r\n\r\n    closeDetails(tool: Tool): void {\r\n        if (tool && tool.name) {\r\n            this.onToolClicked(tool);\r\n        } else {\r\n            this.pathLocationStrategy.back();\r\n        }\r\n    }\r\n\r\n    onToolClicked(tool: Tool): void {\r\n        switch (tool.name) {\r\n            case \"showTags\":\r\n                tool.active = !tool.active;\r\n                break;\r\n            case \"randomGame\":\r\n                this.selectRandomGame();\r\n                break;\r\n        }\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n    }\r\n\r\n    onSearchResultClick(result: SearchResult): void {\r\n        switch(result.type) {\r\n            case 'search':\r\n                this.filter = {\r\n                    \"property\": \"search\",\r\n                    \"value\" : 0\r\n                }\r\n                this.getGamesSearch(result.text);\r\n                this.setTitle();\r\n                return;\r\n            case 'name':\r\n                this.gameDatabaseService.getGame(result.id)\r\n                    .then((game) => this.onSelect(game));\r\n                return;\r\n            case 'tag':\r\n                this.filter = {\r\n                    \"property\": 'TagID',\r\n                    \"value\": result.id\r\n                }\r\n                break;\r\n            case 'duration':\r\n                this.filter = {\r\n                    \"property\": 'DurationID',\r\n                    \"value\": result.id\r\n                }\r\n                break;\r\n            case 'playercount':\r\n                this.filter = {\r\n                    \"property\": 'PlayerCountID',\r\n                    \"value\": result.id\r\n                }\r\n                break;\r\n        }\r\n        this.getGames();\r\n        this.setTitle();\r\n    }\r\n\r\n    onSearch(term: string): void {\r\n        this.gameDatabaseService.searchForResults(term)\r\n            .then((results) => this.searchResults = results);\r\n    }\r\n\r\n    clearFilter(): void {\r\n        // TODO: back button should clear filters\r\n        this.filter = null;\r\n        this.getGames();\r\n        this.setTitle();\r\n    }\r\n\r\n}\r\n"]}