{"version":3,"sources":["../../app/src/app/view/game-note.view.ts"],"names":[],"mappings":"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","file":"game-note.view.js","sourcesContent":["import { \r\n    Component,\r\n    OnInit,\r\n    Input,\r\n    Output,\r\n    EventEmitter,\r\n    ViewChild,\r\n    ElementRef\r\n} from '@angular/core';\r\n\r\nimport { TimeUtil } from '../../util/time.util';\r\n\r\nimport { UserService } from '../../service/user.service';\r\n\r\nimport { Game } from '../../model/game';\r\nimport { Note } from '../../model/note';\r\nimport { Tag } from '../../model/tag';\r\nimport { GameMetadata } from '../../model/game-metadata';\r\n\r\nimport { DropdownOption } from '../view/editable-metadata.view';\r\n\r\nimport { GameNoteService } from '../service/game-note.service';\r\n\r\nimport { ShrinkAnim } from '../../util/anim.util';\r\n\r\nimport { Util } from '../../util/util';\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    selector: '.improvplus-game-note',\r\n    templateUrl: '../template/view/game-note.view.html',\r\n    animations: [ShrinkAnim.height]\r\n})\r\nexport class GameNoteView implements OnInit {\r\n\r\n    @Input() note: Note;\r\n    @Input() game: Game;\r\n\r\n    @Output() create: EventEmitter<Note> = new EventEmitter();\r\n    @Output() remove: EventEmitter<Note> = new EventEmitter();\r\n\r\n    @ViewChild('description') descriptionElement: ElementRef;\r\n    @ViewChild('noteinput') inputElement: ElementRef;\r\n\r\n    showEdit: boolean;\r\n    editable: boolean;\r\n    showText: boolean;\r\n\r\n    showUserName: boolean = true;\r\n\r\n    isPosting: boolean;\r\n\r\n    noteInput: string;\r\n    noteContext: string;\r\n    noteContextOptions: DropdownOption[];\r\n    notePublic: boolean;\r\n    noteTeam: boolean;\r\n\r\n    constructor(\r\n        private userService: UserService,\r\n        private noteService: GameNoteService\r\n    ) { }\r\n    \r\n    ngOnInit() {\r\n        if (!this.note) {\r\n            this.setupNoteEdit();\r\n        } else {\r\n            let user = this.userService.getLoggedInUser();\r\n\r\n            this.note.teams.forEach(team => {\r\n                if (Util.indexOfId(user.adminOfTeams, team) > -1) {\r\n                    this.editable = true;\r\n                }\r\n            });\r\n\r\n            if (this.note.addedUser._id == user._id) {\r\n                this.editable = true;\r\n                this.showUserName = false;\r\n            }\r\n            this.showText = true;\r\n        }\r\n    }\r\n\r\n    setupNoteEdit(): void {\r\n        if (this.note && !this.editable) {\r\n            return;\r\n        }\r\n\r\n        this.showEdit = false;\r\n        this.showText = false;\r\n\r\n        this.noteContextOptions = [\r\n            {\r\n                name: 'This game: ' + this.game.names[0].name,\r\n                _id: 'game',\r\n                icon: 'rocket',\r\n                description: 'This note will only apply to this game.'\r\n            },\r\n            {\r\n                name: this.game.playerCount.name + ' Players',\r\n                _id: 'metadata_' + this.game.playerCount._id,\r\n                icon: 'users',\r\n                description: 'This note will apply to any game involving \\'' + this.game.playerCount.name + '\\' player count.'\r\n            },\r\n            {\r\n                name: this.game.duration.name,\r\n                _id: 'metadata_' + this.game.duration._id,\r\n                icon: 'users',\r\n                description: 'This note will apply to any game involving \\'' + this.game.duration.name + '\\' duration.'\r\n            }\r\n        ];\r\n\r\n        this.game.tags.forEach(taggame => {\r\n            let tag = <Tag> taggame.tag;\r\n            this.noteContextOptions.push({\r\n                name: tag.name,\r\n                _id: 'tag_' + tag._id,\r\n                icon: 'hashtag',\r\n                description: 'This note will apply to any game tagged \\'' + tag.name + '\\'.'\r\n            })\r\n        });\r\n\r\n        this.noteContext = '';\r\n\r\n        if (this.note) {\r\n            this.noteInput = this.note.description;\r\n            if (this.note.teams && this.note.teams.length) {\r\n                this.noteTeam = true;\r\n            } else {\r\n                this.noteTeam = false;\r\n            }\r\n            if (this.note.game) {\r\n                this.noteContext = 'game';\r\n            } else if (this.note.metadata) {\r\n                this.noteContext = 'metadata_' + (<GameMetadata> this.note.metadata)._id;\r\n            } else if (this.note.tag) {\r\n                this.noteContext = 'tag_' + (<Tag> this.note.tag)._id;\r\n            }\r\n\r\n            let height = (<HTMLElement> this.descriptionElement.nativeElement).offsetHeight;\r\n\r\n            setTimeout(() => {\r\n                (<HTMLElement> this.inputElement.nativeElement).style.height = (height + 32) + 'px';\r\n            }, 10);\r\n        } else {\r\n            setTimeout(() => {\r\n                (<HTMLElement> this.inputElement.nativeElement).style.height = '';\r\n            }, 10);\r\n        }\r\n\r\n        this.showEdit = true;\r\n\r\n    }\r\n\r\n    cancelEdit(): void {\r\n        this.showEdit = false;\r\n        this.showText = false;\r\n\r\n        this.showText = true;\r\n    }\r\n\r\n    setNoteContext(context: DropdownOption): void {\r\n        this.noteContext = context._id;\r\n    }\r\n\r\n    saveNote(): void {\r\n        if (!this.noteContext) {\r\n            this.noteContext = this.noteContextOptions[0]._id;\r\n        }\r\n\r\n        let note = this.note || new Note();\r\n\r\n        note.description = this.noteInput;\r\n        \r\n        if (this.noteContext == 'game') {\r\n            note.game = this.game._id;\r\n        } else if (this.noteContext.indexOf('tag_') > -1) {\r\n            note.tag = this.noteContext.replace('tag_', '');\r\n        } else if (this.noteContext.indexOf('metadata_') > -1) {\r\n            note.metadata = this.noteContext.replace('metadata_', '');\r\n        }\r\n\r\n        note.public = this.notePublic;\r\n\r\n        if (this.noteTeam) {\r\n            note.teams = [].concat(this.userService.getTeams(), this.userService.getAdminTeams());\r\n        } else {\r\n            note.teams = [];\r\n        }\r\n\r\n        this.isPosting = true;\r\n\r\n        if (this.note) {\r\n\r\n            this.noteService.updateNote(note).then(note => {\r\n                this.isPosting = false;\r\n                this.cancelEdit();\r\n            });\r\n\r\n        } else {\r\n\r\n            this.noteService.createNote(note).then(note => {\r\n                this.isPosting = false;\r\n                this.noteInput = '';\r\n                this.create.emit(note);\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n}"]}