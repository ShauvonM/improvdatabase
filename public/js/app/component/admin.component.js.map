{"version":3,"sources":["../../app/src/app/component/admin.component.ts"],"names":[],"mappings":"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","file":"admin.component.js","sourcesContent":["import { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\n\r\nimport {AppComponent} from '../../component/app.component';\r\nimport { Tool } from '../view/toolbar.view';\r\n\r\nimport { API } from '../../constants';\r\n\r\nimport { TabData } from '../../model/tab-data';\r\n\r\nimport { AppService } from '../../service/app.service';\r\nimport { HistoryService } from '../service/history.service';\r\nimport { GameDatabaseService } from '../service/game-database.service';\r\n\r\nimport { Subscription } from '../../model/subscription';\r\nimport { HistoryModel } from '../../model/history';\r\nimport { Tag } from '../../model/tag';\r\n\r\nimport { UserService } from '../../service/user.service';\r\n\r\nimport { TimeUtil } from '../../util/time.util';\r\n\r\nimport { AppHttp } from '../../data/app-http';\r\n\r\nimport { Util } from '../../util/util';\r\nimport { DialogAnim } from '../../util/anim.util';\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    selector: \"admin\",\r\n    templateUrl: \"../template/admin.component.html\",\r\n    animations: [DialogAnim.dialog]\r\n})\r\nexport class AdminComponent implements OnInit {\r\n\r\n    @ViewChild('versionFileInput') versionFileInput: ElementRef;\r\n\r\n    title: string = '<span class=\"light\">super</span><strong>admin</strong>';\r\n\r\n    tabs: TabData[] = [\r\n        {\r\n            name: 'History',\r\n            id: 'history',\r\n            icon: 'history'\r\n        }\r\n    ];\r\n    selectedTab: string = 'history';\r\n\r\n    newVersionFile: File;\r\n\r\n    histories: HistoryModel[];\r\n    historyDisplayCount: number = 0;\r\n    rawHistories: HistoryModel[] = [];\r\n    historyShowRefresh: boolean;\r\n    historyShowLogin: boolean;\r\n    historyShowStuff: boolean = true;\r\n\r\n    isPosting: boolean;\r\n\r\n    constructor(\r\n        public _app: AppComponent,\r\n        private router: Router,\r\n        private _service: AppService,\r\n        private userService: UserService,\r\n        private historyService: HistoryService,\r\n        private gameService: GameDatabaseService,\r\n        private http: AppHttp\r\n    ) { }\r\n\r\n    _tools: Tool[] = [\r\n        {\r\n            icon: \"fa-database\",\r\n            name: \"backup\",\r\n            text: \"Back Up Database\"\r\n        },\r\n        {\r\n            icon: \"fa-cloud-upload\",\r\n            name: \"restoredb\",\r\n            text: \"Restore Database from Backup\"\r\n        }\r\n    ]\r\n\r\n    onToolClicked(tool: Tool): void {\r\n        switch (tool.name) {\r\n            case \"backup\":\r\n                this.doBackup();\r\n                break;\r\n            case \"restoredb\":\r\n                this.restore();\r\n                break;\r\n        }\r\n    }\r\n\r\n    ngOnInit(): void {\r\n        this.getHistory();\r\n    }\r\n\r\n    selectTab(tab: TabData): void {\r\n        this.selectedTab = tab.id;\r\n    }\r\n\r\n    back(): void {\r\n    }\r\n\r\n    simpleDate(date: string): string {\r\n        return TimeUtil.simpleDate(date);\r\n    }\r\n\r\n    simpleDateTime(date: string): string {\r\n        return TimeUtil.simpleDate(date) + ' ' + TimeUtil.simpleTime(date);\r\n    }\r\n\r\n    getHistory(): void {\r\n        this.historyService.getAllHistory().then(histories => {\r\n            this.rawHistories = histories;\r\n            this.filterHistory();\r\n        });\r\n    }\r\n\r\n    getHistoryIcon(history: HistoryModel): string {\r\n        switch(history.action) {\r\n            case 'game_edit':\r\n                return 'fa-rocket';\r\n            case 'change_password':\r\n                return 'fa-key';\r\n            case 'note_edit':\r\n                return 'fa-sticky-note';\r\n            case 'account_edit':\r\n                return 'fa-user';\r\n            case 'team_join':\r\n                return 'fa-user-plus';\r\n            case 'team_leave':\r\n                return 'fa-user-times';\r\n            case 'team_user_promote':\r\n                return 'fa-black-tie';\r\n            case 'login':\r\n                return 'fa-sign-in';\r\n            case 'logout':\r\n                return 'fa-sign-out';\r\n            case 'refresh':\r\n                return 'fa-refresh';\r\n            default:\r\n                return 'fa-history';\r\n        }\r\n    }\r\n\r\n    historyLink(event: MouseEvent, history: HistoryModel): void {\r\n        switch(history.action) {\r\n            case 'game_edit':\r\n            case 'game_tag_add':\r\n            case 'game_tag_remove':\r\n                this.router.navigate(['/app/game', history.target]);\r\n                break;\r\n        }\r\n\r\n        event.preventDefault();\r\n\r\n    }\r\n\r\n    expandedHistory: HistoryModel;\r\n    expandedHistoryTargetName: string;\r\n    expandHistory(history: HistoryModel): void {\r\n        if (this.expandedHistory == history ||\r\n                history.action == 'login' || history.action == 'logout' || history.action == 'refresh') {\r\n\r\n            this.expandedHistory = null;\r\n            return;\r\n        }\r\n\r\n        this.expandedHistory = history;\r\n\r\n        let target = history.target,\r\n            reference = history.reference;\r\n\r\n        this.expandedHistoryTargetName = 'loading';\r\n\r\n        switch(history.action) {\r\n            case 'game_edit':\r\n                this.gameService.getGame(target).then(game => {\r\n                    if (game.names.length) {\r\n                        this.expandedHistoryTargetName = game.names[0].name;\r\n                    } else {\r\n                        this.expandedHistoryTargetName = '';\r\n                    }\r\n                });\r\n                break;\r\n            case 'game_tag_add':\r\n                this.gameService.getGame(target).then(game => {\r\n                    this.expandedHistoryTargetName = '';\r\n                    if (game.tags.length) {\r\n                        let index = Util.indexOfId(game.tags, reference);\r\n                        if (index > -1) {\r\n                            this.expandedHistoryTargetName = '<span class=\"tag\"><i class=\"fa fa-hashtag\"></i> ' + (<Tag> game.tags[index]).name + '</span> &gt; ';\r\n                        }\r\n                    }\r\n\r\n                    if (game.names.length) {\r\n                        this.expandedHistoryTargetName += game.names[0].name;\r\n                    }\r\n                })\r\n                break;\r\n            case 'game_tag_remove':\r\n                this.gameService.getGame(target).then(game => {\r\n                    this.expandedHistoryTargetName = '';\r\n                    this.expandedHistoryTargetName = '<span class=\"tag\"><i class=\"fa fa-remove\"></i> ' + reference + '</span> &lt; ';\r\n\r\n                    if (game.names.length) {\r\n                        this.expandedHistoryTargetName += game.names[0].name;\r\n                    }\r\n                })\r\n                break;\r\n            default:\r\n                this.expandedHistoryTargetName = '';\r\n                break;\r\n        }\r\n    }\r\n\r\n    filterHistory(): void {\r\n        setTimeout(() => {\r\n            let count = 0;\r\n            this.histories = [];\r\n            this.rawHistories.some(h => {\r\n                let include;\r\n                if (h.action == 'refresh') {\r\n                    include = this.historyShowRefresh;\r\n                } else if (h.action == 'login' || h.action == 'logout' ) {\r\n                    include = this.historyShowLogin;\r\n                } else {\r\n                    include = this.historyShowStuff;\r\n                }\r\n                if (include) {\r\n                    this.histories.push(h)\r\n                    count++;\r\n                    if (count >= this.historyDisplayCount) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            });\r\n            setTimeout(() => {\r\n                this.isPosting = false;\r\n            }, 10);\r\n        }, 10);\r\n    }\r\n\r\n    loadMoreHistory(count: number): void {\r\n        this.isPosting = true;\r\n\r\n        this.historyDisplayCount = (30 * count);\r\n        this.filterHistory();\r\n    }\r\n\r\n    doBackup(): void {\r\n        this.http.get('/api/backup').toPromise().then(response => {\r\n            let data = response.json();\r\n            this._app.toast(data.timestamp);\r\n        })\r\n    }\r\n\r\n    restore(): void {\r\n        this._app.dialog('Are you sure?', 'Restoring the database backup cannot be undone or stopped.', 'Do it', (timestamp: string) => {\r\n            setTimeout(() => {\r\n                this._app.toast('Restoring data . . .');\r\n                this._app.showLoader();\r\n                this.http.put('/api/restore', {timestamp: timestamp}).toPromise().then(response => {\r\n                    this._app.hideLoader();\r\n                    this._app.toast('Data restored');\r\n                });\r\n            }, 10);\r\n        }, false, 'Timestamp');\r\n    }\r\n\r\n}\r\n"]}