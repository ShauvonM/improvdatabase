{"version":3,"sources":["../../app/src/component/signup.component.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,sCAOuB;AACvB,0CAAiE;AAEjE,iDAA+C;AAC/C,sDAAoD;AACpD,wDAAsD;AAEtD,sCAAqC;AAGrC,+CAA2D;AAI3D,qCAAoC;AAapC;IA4BI,yBACW,IAAkB,EACjB,QAAoB,EACpB,MAAc,EACd,KAAqB,EACrB,WAAwB;QAJzB,SAAI,GAAJ,IAAI,CAAc;QACjB,aAAQ,GAAR,QAAQ,CAAY;QACpB,WAAM,GAAN,MAAM,CAAQ;QACd,UAAK,GAAL,KAAK,CAAgB;QACrB,gBAAW,GAAX,WAAW,CAAa;QAtBpC,cAAS,GAAY,KAAK,CAAC;QAU3B,iBAAY,GAAY,KAAK,CAAC;IAa1B,CAAC;IAEL,kCAAQ,GAAR;QAAA,iBAYC;QAVG,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;YAChC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,gBAAgB,CAAC,EAAE,EAAC,UAAU,EAAE,IAAI,EAAC,CAAC,CAAC;QACjE,CAAC;QAED,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,UAAC,MAAc;YACrC,KAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;QACjC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,KAAK,EAAE,CAAC;IAEjB,CAAC;IAED,+BAAK,GAAL;QAAA,iBAgBC;QAdG,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;QAE/B,IAAI,CAAC,UAAU,GAAG,WAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,UAAA,CAAC;YACzD,KAAI,CAAC,YAAY,GAAG,CAAC,CAAC,QAAQ,CAAC;YAE/B,EAAE,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;gBACV,KAAI,CAAC,SAAS,GAAG,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC;YACrC,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,KAAI,CAAC,SAAS,GAAG,EAAE,CAAC;YACxB,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC;IAE3C,CAAC;IAGD,oCAAU,GAAV;QAAA,iBAQC;QAPG,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAE9B,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;QACrB,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAC5B,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;YACzB,KAAI,CAAC,aAAa,EAAE,CAAC;QACzB,CAAC,EAAE,IAAI,CAAC,CAAC;IACb,CAAC;IAED,uCAAa,GAAb;QAAA,iBAgBC;QAfG,IAAI,IAAI,GAAG,IAAI,WAAI,EAAE,CAAC;QAEtB,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;YAC/D,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;YACxB,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,UAAA,OAAO;gBACzC,KAAI,CAAC,UAAU,GAAG,OAAO,CAAC;gBAC1B,KAAI,CAAC,eAAe,GAAG,KAAK,CAAC;YACjC,CAAC,CAAC,CAAC;QACP,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;YAC/B,IAAI,CAAC,UAAU,GAAG,iDAAiD,CAAC;YACpE,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;QACjC,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;YACrB,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;QACjC,CAAC;IACL,CAAC;IAED,qCAAW,GAAX;QACI,MAAM,CAAC,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,QAAQ;IACjK,CAAC;IAED,uCAAa,GAAb;QAAA,iBAyBC;QAxBG,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YACtB,MAAM,CAAC;QACX,CAAC;QAED,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;QAEjC,EAAE,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;YACjC,IAAI,CAAC,WAAW,GAAG,4DAA4D,CAAA;YAC/E,MAAM,CAAC;QACX,CAAC;QAED,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QAEtB,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;YACnC,WAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,UAAC,MAAW;gBAC3E,EAAE,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;oBACf,KAAI,CAAC,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC;gBAC1C,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,KAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBAC/B,CAAC;YACL,CAAC,CAAC,CAAC;QACP,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,IAAI,CAAC,OAAO,EAAE,CAAC;QACnB,CAAC;IACL,CAAC;IAEO,iCAAO,GAAf,UAAgB,KAAW;QAA3B,iBAoBC;QAnBG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC;aAC5F,IAAI,CAAC,UAAA,IAAI;YACN,KAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC;YACvB,EAAE,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;gBACrB,MAAM,CAAC,KAAI,CAAC,WAAW,CAAC,KAAK,CAAC,KAAI,CAAC,KAAK,EAAE,KAAI,CAAC,QAAQ,CAAC,CAAC;YAC7D,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,SAAS;gBACT,KAAI,CAAC,IAAI,CAAC,KAAK,CAAC,wDAAwD,CAAC,CAAC;YAC9E,CAAC;QACL,CAAC,EAAE,UAAA,QAAQ;YACP,KAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC;YACvB,KAAI,CAAC,SAAS,GAAG,KAAK,CAAC;YACvB,IAAI,GAAG,GAAG,QAAQ,CAAC,IAAI,EAAE,CAAC;YAC1B,KAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;YAEvB,6BAA6B;YAE7B,mCAAmC;QACvC,CAAC,CAAC,CAAC;IACX,CAAC;IAEO,sCAAY,GAApB,UAAqB,GAAQ;QACzB,EAAE,CAAC,CAAC,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,KAAK,IAAI,sBAAsB,CAAC,CAAC,CAAC;YACnD,IAAI,CAAC,UAAU,GAAG,2CAA2C,CAAC;QAClE,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,KAAK,IAAI,gBAAgB,CAAC,CAAC,CAAC;YACpD,IAAI,CAAC,WAAW,GAAG,8CAA8C,CAAC;QACtE,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,KAAK,IAAI,cAAc,CAAC,CAAC,CAAC;YAClD,IAAI,CAAC,WAAW,GAAG,uCAAuC,CAAC;QAC/D,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,KAAK,IAAI,aAAa,CAAC,CAAC,CAAC;YACjD,IAAI,CAAC,UAAU,GAAG,sFAAsF,CAAA;QAC5G,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;YACnB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,wBAAwB,EAAE,yLAAyL,EAAE,UAAU,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QAClQ,CAAC;IACL,CAAC;IAED,mCAAS,GAAT;QACI,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QACzB,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;IACnC,CAAC;IAED,mCAAS,GAAT;QACI,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAC1B,IAAI,CAAC,kBAAkB,GAAG,KAAK,CAAC;IACpC,CAAC;IAED,wCAAc,GAAd;QACI,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QACzB,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC;IACxC,CAAC;IAED,wCAAc,GAAd;QACI,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAC1B,IAAI,CAAC,uBAAuB,GAAG,KAAK,CAAC;IACzC,CAAC;IAtLQ,eAAe;QAT3B,gBAAS,CAAC;YACP,QAAQ,EAAE,MAAM,CAAC,EAAE;YACnB,QAAQ,EAAE,QAAQ;YAClB,WAAW,EAAE,mCAAmC;YAChD,UAAU,EAAE;gBACR,sBAAU,CAAC,MAAM;gBACjB,sBAAU,CAAC,MAAM;aACpB;SACJ,CAAC;yCA8BmB,4BAAY;YACP,wBAAU;YACZ,eAAM;YACP,uBAAc;YACR,0BAAW;OAjC3B,eAAe,CAwL3B;IAAD,sBAAC;CAxLD,AAwLC,IAAA;AAxLY,0CAAe","file":"signup.component.js","sourcesContent":["import { \r\n    Component,\r\n    OnInit,\r\n    ViewChild,\r\n    ViewChildren,\r\n    QueryList,\r\n    ElementRef\r\n} from '@angular/core';\r\nimport { Router, ActivatedRoute, Params } from '@angular/router';\r\n\r\nimport { AppComponent } from './app.component';\r\nimport { AppService } from '../service/app.service';\r\nimport { UserService } from '../service/user.service';\r\n\r\nimport { User } from '../model/user';\r\nimport { Team } from '../model/team';\r\n\r\nimport { ShrinkAnim, DialogAnim } from '../util/anim.util';\r\n\r\nimport { BracketCardDirective } from '../directive/bracket-card.directive';\r\n\r\nimport { Util } from '../util/util';\r\n\r\ndeclare var Stripe: any;\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    selector: \"signup\",\r\n    templateUrl: '../template/signup.component.html',\r\n    animations: [\r\n        DialogAnim.dialog,\r\n        ShrinkAnim.height\r\n    ]\r\n})\r\nexport class SignupComponent implements OnInit {\r\n    [key:string]: any;\r\n\r\n    inviteId: string;\r\n\r\n    email: string;\r\n    password: string;\r\n    userName: string;\r\n\r\n    pledge: string;\r\n\r\n    isPosting: boolean = false;\r\n\r\n    creditCard: any;\r\n\r\n    emailValidating: boolean;\r\n    emailError: string;\r\n    cardError: string;\r\n\r\n    inviteError: string;\r\n\r\n    cardComplete: boolean = false;\r\n\r\n    termsDialogVisible: boolean;\r\n    termsAccepted: boolean;\r\n    \r\n    pledgeInfoDialogVisible: boolean;\r\n\r\n    constructor(\r\n        public _app: AppComponent,\r\n        private _service: AppService,\r\n        private router: Router,\r\n        private route: ActivatedRoute,\r\n        private userService: UserService\r\n    ) { }\r\n\r\n    ngOnInit(): void {\r\n\r\n        if (this.userService.isLoggedIn()) {\r\n            this.router.navigate(['/app/dashboard'], {replaceUrl: true});\r\n        }\r\n\r\n        this.route.params.forEach((params: Params) => {\r\n            this.inviteId = params['id'];\r\n        });\r\n\r\n        this.setup();\r\n\r\n    }\r\n\r\n    setup(): void {\r\n\r\n        this._app.showBackground(true);\r\n\r\n        this.creditCard = Util.setupStripe(this._app.config.stripe, e => {\r\n            this.cardComplete = e.complete;\r\n\r\n            if (e.error) {\r\n                this.cardError = e.error.message;\r\n            } else {\r\n                this.cardError = '';\r\n            }\r\n        });\r\n\r\n        this.creditCard.mount('#card-element');\r\n\r\n    }\r\n\r\n    emailTimer: any;\r\n    emailInput(): void {\r\n        clearTimeout(this.emailTimer);\r\n\r\n        this.emailError = '';\r\n        this.emailValidating = true;\r\n        this.emailTimer = setTimeout(() => {\r\n            this.validateEmail();\r\n        }, 1000);\r\n    }\r\n\r\n    validateEmail(): void {\r\n        let user = new User();\r\n\r\n        if (this.email.indexOf('@') > -1 && this.email.indexOf('.') > -1) {\r\n            user.email = this.email;\r\n            this._service.validateUser(user).then(message => {\r\n                this.emailError = message;\r\n                this.emailValidating = false;\r\n            });\r\n        } else if (this.email.length > 0) {\r\n            this.emailError = 'This does not seem to be a valid email address.';\r\n            this.emailValidating = false;\r\n        } else {\r\n            this.emailError = '';\r\n            this.emailValidating = false;\r\n        }\r\n    }\r\n\r\n    isFormValid(): boolean {\r\n        return !this.emailValidating && !!this.email && !!!this.emailError && !!this.password && !!!this.cardError && (!!!this.pledge || this.cardComplete); // !!!!!\r\n    }\r\n\r\n    submitPayment(): void {\r\n        if (!this.isFormValid()) {\r\n            return;\r\n        }\r\n\r\n        this.pledge = this.pledge.trim();\r\n\r\n        if (isNaN(parseFloat(this.pledge))) {\r\n            this.inviteError = \"Please enter a number (or nothing) for your pledge amount.\"\r\n            return;\r\n        }\r\n\r\n        this.isPosting = true;\r\n\r\n        if (this.pledge && this.cardComplete) {\r\n            Util.getStripeToken(this._app.config.stripe, this.creditCard).then((result: any) => {\r\n                if (result.error) {\r\n                    this.cardError = result.error.message;\r\n                } else {\r\n                    this._signup(result.token);\r\n                }\r\n            });\r\n        } else {\r\n            this._signup();\r\n        }\r\n    }\r\n\r\n    private _signup(token?: any): void {\r\n        this._service.signup(this.email, this.password, this.userName, this.pledge, token, this.inviteId)\r\n            .then(user => {\r\n                this._app.hideLoader();\r\n                if (user && user.email) {\r\n                    return this.userService.login(this.email, this.password);\r\n                } else {\r\n                    // uh oh?\r\n                    this._app.toast(\"Something bad happened. I'm not sure what to tell you.\");\r\n                }\r\n            }, response => {\r\n                this._app.hideLoader();\r\n                this.isPosting = false;\r\n                let msg = response.json();\r\n                this._handleError(msg);\r\n\r\n                // TODO: handle invite errors\r\n\r\n                // TODO: verify the invite on load?\r\n            });\r\n    }\r\n\r\n    private _handleError(msg: any): void {\r\n        if (msg.error && msg.error == 'email already exists') {\r\n            this.emailError = \"That email address is already registered.\";\r\n        } else if (msg.error && msg.error == 'unknown invite') {\r\n            this.inviteError = \"That invite code doesn't appear to be valid.\";\r\n        } else if (msg.error && msg.error == 'invite taken') {\r\n            this.inviteError = 'That invite has already been claimed.';\r\n        } else if (msg.error && msg.error == 'wrong email') {\r\n            this.emailError = \"Please use the email address that this invite was sent to (you can change it later).\"\r\n        } else if (msg.error) {\r\n            this._app.dialog('An error has occurred.', 'We are so sorry. Something happened, and we can\\'t be sure what. Please try again, and if this keeps happening, reach out to us by emailing contact@improvpl.us. Have a nice day, dude.', 'Okay bye', null, true);\r\n        }\r\n    }\r\n\r\n    showTerms(): void {\r\n        this._app.backdrop(true);\r\n        this.termsDialogVisible = true;\r\n    }\r\n\r\n    hideTerms(): void {\r\n        this._app.backdrop(false);\r\n        this.termsDialogVisible = false;\r\n    }\r\n\r\n    showPledgeInfo(): void {\r\n        this._app.backdrop(true);\r\n        this.pledgeInfoDialogVisible = true;\r\n    }\r\n\r\n    hidePledgeInfo(): void {\r\n        this._app.backdrop(false);\r\n        this.pledgeInfoDialogVisible = false;\r\n    }\r\n\r\n}\r\n"]}